{% extends "base.html" %}

{% block title %}
  <title>Home</title>
{% endblock %}

{% block body %}
  {% if current_user.is_authenticated %}
    
    <div class="container my-4">
      <div class="row">
        <div class="col">
          <h6 class="display-6">DASHBOARD</h6>
        </div>
        <div class="col text-end">
          <h6 class="display-6">{{ today }}</h6>
        </div>
      </div>
      <hr>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <div class="container">
      <div class="row">
        <div class="col text-center">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Finance Data</h5>
              <table class="table">
                <thead>
                  <tr>
                    <th>-</th>
                    <th>Today</th>
                    <th>Week</th>
                    <th>Month</th>
                    <th>Year</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th style="color: green;">Incomings</th>
                    <td style="color: green;">{{ data['current_day_income'] | usd }}</td>
                    <td style="color: green;">{{ data['current_week_income'] | usd }}</td>
                    <td style="color: green;">{{ data['current_month_income'] | usd }}</td>
                    <td style="color: green;">{{ data['current_year_income'] | usd }}</td>
                  </tr>
                  <tr>
                    <th style="color: red;">Outgoings</th>
                    <td style="color: red;">{{ data['current_day_outgoing'] | usd }}</td>
                    <td style="color: red;">{{ data['current_week_outgoing'] | usd }}</td>
                    <td style="color: red;">{{ data['current_month_outgoing'] | usd }}</td>
                    <td style="color: red;">{{ data['current_year_outgoing'] | usd }}</td>
                  </tr>
                  <tr>
                    <th style="color: blue;">Liquid</th>
                    <td>{{ data['total_day'] | usd }}</td>
                    <td>{{ data['total_week'] | usd }}</td>
                    <td>{{ data['total_month'] | usd }}</td>
                    <td>{{ data['total_year'] | usd  }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container text-center">
      <div class="row my-5">
        <div class="col-6">
          <div class="card">
            <div class="card-body">
              <div>
                <b class="h5">Incomings (YTD)</b>
                <canvas id="myChart"></canvas>
              </div>
              <script>
                let incomings = JSON.parse({{ total_monthly_inc | tojson }});
                let months_label = JSON.parse({{ months_ytd | tojson }});
                const ctx = document.getElementById('myChart')
                
                var chart1 = new Chart(ctx, {
                  type: 'bar',
                  data: {
                  labels: months_label,
                    datasets: [{
                      label: 'income',
                      data: incomings,
                      borderWidth: 1,
                      backgroundColor: [
                        'rgb(65, 105, 225)'
                      ]
                      }]
                    },
                  options: {
                    scales: {
                      y: {
                        beginAtZero: true
                        }
                      }
                    }
                  });
              </script>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="card">
            <div class="card-body">
              <div>
                <b class="h5">Outgoings (YTD)</b>
                <canvas id="myChart2"></canvas>
              </div>
              <script>
                let outgoings = JSON.parse({{ total_monthly_out | tojson}})
                    
                const ctx2 = document.getElementById('myChart2')  
                    
                var chart2 = new Chart(ctx2, {
                  type: 'bar',
                  data: {
                    labels: months_label,
                    datasets: [{
                      label: 'outgoing',
                      data: outgoings,
                      backgroundColor: [
                        'rgb(178, 34, 34)'
                        ],
                      hoverOffset: 4
                      }]
                    },
                  options: {
                    scales: {
                      y: {
                        beginAtZero: true
                        }
                      }
                    }
                  });
                </script>
            </div>
          </div>
        </div>
      </div>
      <div class="row align-items-center my-5">
        <div class="col align-self-center">
          <div class="card">
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>-</th>
                    <th class="h5">Cash</th>
                    <th class="h5">Bank Account</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th class="h5" style="color: green;">Incomings</th>
                    <td style="color: green">{{ finance_data['cash_incomings'] | usd }}</td>
                    <td style="color: green;">{{ finance_data['bank_incomings'] | usd }}</td>
                  </tr>
                  <tr>
                    <th class="h5" style="color: red;">Outgoings</th>
                    <td style="color: red;">{{ finance_data['cash_outgoings'] | usd }}</td>
                    <td style="color: red;">{{ finance_data['bank_outgoings'] | usd }}</td>
                  </tr>
                  <tr>
                    <th class="h5">Total</th>
                    <td>{{ finance_data['total_cash'] | usd }}</td>
                    <td>{{ finance_data['total_bank'] | usd }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="row my-5 align-items-center">
        <div class="col-6 align-self-center">
          <div class="card">
            <div class="card-body">
              <div>
                <b class="h5">Liquid Profit (YTD)</b>
                <canvas id="myChart6"></canvas>
              </div>
              <script>
                let liquid = JSON.parse({{ liquid | tojson }});
                const ctx6 = document.getElementById('myChart6')
                var chart6 = new Chart(ctx6, {
                  type: 'line',
                  data: {
                    labels: months_label,
                    datasets: [{
                      label: '# liquid',
                      data: liquid ,
                      borderWidth: 1
                      }]
                    },
                  options: {
                    scales: {
                      y: {
                        beginAtZero: true
                        }
                      }
                    }
                  });
              </script>
            </div>
          </div>
        </div>
        <div class="col-1"></div>
        <div class="col-3 align-self-center">
          <div>
            <b class="h5">Total Cash Flow</b>
            <canvas id="myChart7"></canvas>
          </div>
          <script>
            Chart.overrides.pie.plugins.legend.position = 'top';

            let incomings_outgoings = JSON.parse({{ incomings_outgoings | tojson }});
            const ctx7 = document.getElementById('myChart7');
            let chart7 = new Chart(ctx7, {
              type: 'pie',
              data: {
                labels: ['incomings', 'outgoings'],
                datasets: [{
                  label: 'total',
                  data: incomings_outgoings,
                  hoverOffset: 4,
                  backgroundColor: [
                    'rgb(54, 162, 235)',
                    'rgb(255, 99, 71)',
                    'rgb(189, 183, 107)'
                  ],
                }]                  
              }
            });
          </script>
        </div>
      </div>
      <div class="row my-5">
        <div class="col">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Incomings Taxes (Total)</h5>
              <table class="table">
                <thead>
                  <tr>
                    <th>-</th>
                    <th class="h5">Cash</th>
                    <th class="h5">Debit</th>
                    <th class="h5">Credit</th>
                    <th class="h5">(Sum)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th class="h5">Total</th>
                    {% for incom_typ_tax in incomings_type_taxes %}
                    <td>{{ incom_typ_tax | usd }}</td>
                    {% endfor %}
                    <td>{{ total_tax_sum | usd }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Outgoings vs. Incomings (Total)</h5>
              <table class="table">
                <thead>
                  <tr>
                    <th>-</th>
                    {% for type_item in type_items %}
                    <th>{{ type_item }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th class="h5">Percentage</th>
                    {% for expen_type in expen_type_percent %}
                    <td>{{ expen_type }}%</td>
                    {% endfor %}
                  </tr>
                </tbody>
              </table>
              <b>*From total income how much the outgoing represents</b>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <div class="row my-5">
        <div class="col-4 align-self-center">
          <div>
            <b class="h5">Incomings Types</b>
            <canvas id="myChart3"></canvas>
          </div>
          <script>
            Chart.overrides.pie.plugins.legend.position = 'right';
            Chart.overrides.doughnut.plugins.legend.position = 'right';         

            const ctx3 = document.getElementById('myChart3');
            let incomings_type = JSON.parse({{ incomings_type | tojson}});
              
            var chart3 = new Chart(ctx3, {
              type: 'doughnut',
              data: {
                labels: ['CASH', 'DEBIT', 'CREDIT'],
                datasets: [{
                  label: 'outgoing',
                  data: incomings_type,
                  hoverOffset: 7,
                  backgroundColor: [
                    'rgb(255, 105, 102)',
                    'rgb(54, 162, 255)',
                    'rgb(255, 205, 70)'
                    ]
                  }],
                options: {
                  title: {
                    display: true,
                    text: "Income Vs Expenses",
                    fontSize: 20
                    },
                  legend: {
                    position: "right",
                    labels: {
                      fontColor: "gray"
                      },
                  display: true
                    },
                  elements: {
                    hitRadius: 5
                    }
                  }                  
                }
              });
          </script>
        </div>
        <div class="col-4 align-self-center">
          <div>
            <b class="h5">Top 5 Suppliers</b>
            <canvas id="myChart4"></canvas>
          </div>
          <script>
            let receivers = JSON.parse({{ receivers | tojson }});
            let payment_by_receiver = JSON.parse({{ payments_by_receiver | tojson }});
              
            const ctx4 = document.getElementById('myChart4')
              
            let chart4 = new Chart(ctx4, {
              type: 'pie',
              data: {
                labels: receivers,
                datasets: [{
                  label: 'receivers',
                  data: payment_by_receiver,
                  hoverOffset: 4,
                  backgroundColor: [
                    'rgb(205, 133, 63)',
                    'rgb(255, 69, 0)',
                    'rgb(0, 128, 128)',
                    'rgb(218, 165, 32)',
                    'rgb(255, 99, 71)',
                    'rgb(255, 205, 86)',
                    'rgb(128, 0, 0)',
                    'rgb(46, 139, 87)',
                    'rgb(100, 149, 237)'

                  ],
                }],
                options: {
                  title: {
                    display: true,
                    text: "Income Vs Expenses",
                    fontSize: 20,
                  },
                  legend: {
                    position: "right",
                    labels: {
                      fontColor: "gray"
                    },
                  display: true,
                  },
                  elements: {
                    hitRadius: 5,
                  }
                }
              } 
            });
          </script>
        </div>
        <div class="col-4 align-self-center">
          <div>
            <b class="h5">Top 5 Outgoings Types</b>
            <canvas id="myChart5"></canvas>
          </div>
          <script>
            let expen_type_cost = JSON.parse({{ expen_type_cost | tojson}});
            let type_list = JSON.parse({{ type_list | tojson }});
            
            const ctx5 = document.getElementById('myChart5')
            
            var chart5 = new Chart(ctx5, {
              type: 'pie',
              data: {
                labels: type_list,
                datasets: [{
                  label: 'expenses',
                  data: expen_type_cost,
                  hoverOffset: 4,
                  backgroundColor: [
                    'rgb(255, 99, 71)',
                    'rgb(54, 162, 235)',
                    'rgb(189, 183, 107)',
                    'rgb(107, 142, 35)',
                    'rgb(173, 255, 47)',
                    'rgb(122, 229, 208)',
                    'rgb(102, 205, 170)',
                    'rgb(136, 105, 86)',
                    'rgb(176, 224, 230)',
                    'rgb(147, 112, 219)'
                  ],
                }]                  
              }
            });
          </script>
        </div>
      </div>
      <hr>
      
    </div>
    
  
  {% else %}
    <div class="container">
      <div class="row align-items-center my-5">
        <div class="col align-self-center">
            <h4 class=" text-center text-primary display-6 font-monospace">Welcome to CashFlow!</h4>
            <p class="text-center text-primary-emphasis"><a href="{{ url_for('login_page')}}"> Access Log In page.</a></p>
        </div>
  {% endif %}

{% endblock %}
